(this.webpackJsonpcloud_dashboard=this.webpackJsonpcloud_dashboard||[]).push([[0],{31:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),r=n(17),o=n.n(r),i=n(18),s=n(2),l="/clouds/dashboard",d=n(9),u=n.n(d),j=n(11),b=n(0),h=function(){var e=function(){var e=Object(j.a)(u.a.mark((function e(t,n,c){var a,r,o,i,s,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("grant_type","authorization_code"),a.append("client_id",n),a.append("client_secret","cloud_dashboard"),a.append("code",t),a.append("redirect_uri",c),e.next=8,fetch("/oauth/token",{method:"POST",body:a});case 8:if((r=e.sent).ok){e.next=11;break}throw new Error("Authorization failed");case 11:return e.next=13,r.json();case 13:if(!("access_token"in(o=e.sent))){e.next=23;break}i=o.access_token,s=o.refresh_token,l=(new Date).getTime()+1e3*o.expires_in,window.localStorage.setItem("accessToken",i),window.localStorage.setItem("refreshToken",s),window.localStorage.setItem("expiresDatetime","".concat(l)),e.next=24;break;case 23:throw new Error("Authorization failed");case 24:case"end":return e.stop()}}),e)})));return function(t,n,c){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){console.group("Authorization Code Grant");var t=window.localStorage.getItem("clientId"),n=window.localStorage.getItem("redirectUri");if(null===t||null==n)return console.log("Client ID : No"),console.error("Authorization failed."),console.groupEnd(),void(window.location.href=l);console.log("Client ID : Yes");var c=new URL(window.location.href).searchParams.get("code");if(null===c)return console.log("Authorization code : No"),console.error("Authorization failed."),console.groupEnd(),void(window.location.href=l);console.log("authorization code : Yes"),e(c,t,n).then((function(){console.log("Access token : Yes"),console.groupEnd(),window.location.href=l+"/main"})).catch((function(){console.log("Access token : No"),console.error("Authorization failed."),console.groupEnd(),window.location.href=l}))}),[]),Object(b.jsx)("h2",{children:"Please waiting..."})},f=n(6),m=function(){var e=Object(c.useState)(""),t=Object(f.a)(e,2),n=t[0],a=t[1],r=Object(c.useState)(""),o=Object(f.a)(r,2),i=o[0],s=o[1],l=function(){var e=Object(j.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/jsonapi/consumer/consumer");case 2:return e.next=4,e.sent.json();case 4:t=e.sent,(n=t.data.filter((function(e){return"Cloud Dashboard"===e.attributes.label}))).length>=1&&(a(n[0].id),s(n[0].attributes.redirect));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){l()}),[]),Object(c.useEffect)((function(){window.localStorage.setItem("clientId",n)}),[n]),Object(c.useEffect)((function(){window.localStorage.setItem("redirectUri",i)}),[i]),Object(b.jsx)("form",{children:Object(b.jsx)("button",{type:"button",className:"btn btn-default",onClick:function(){var e="/oauth/authorize?response_type=code&client_id=".concat(n,"&redirect_uri=").concat(i);window.location.href=e},disabled:""===n,children:"login"})})},O=function(){Object(c.useEffect)((function(){var e=window.localStorage.getItem("accessToken"),t=window.localStorage.getItem("expiresDatetime");null!==e&&null!=t?(new Date).getTime()>parseInt(t,10)&&(window.location.href=l):window.location.href=l}),[]);return Object(b.jsx)("div",{className:"row",children:Object(b.jsx)("div",{className:"col",children:Object(b.jsx)("form",{children:Object(b.jsx)("button",{type:"button",className:"btn btn-default",onClick:function(){window.localStorage.removeItem("accessToken"),window.localStorage.removeItem("refreshToken"),window.localStorage.removeItem("expiresDatetime"),window.location.href=l},children:"logout"})})})})},x=function(){var e=Object(c.useState)([]),t=Object(f.a)(e,2),n=t[0],a=t[1],r=Object(c.useState)(30),o=Object(f.a)(r,1)[0],i=Object(c.useState)(0),s=Object(f.a)(i,2),d=s[0],u=s[1],j=Object(c.useState)([]),h=Object(f.a)(j,2),m=h[0],O=h[1],x=Object(c.useState)(""),p=Object(f.a)(x,2),g=p[0],k=p[1],w=Object(c.useState)([]),_=Object(f.a)(w,2),S=_[0],v=_[1],C=Object(c.useState)(""),y=Object(f.a)(C,2),N=y[0],E=y[1],D=Object(c.useState)({key:"",direction:"ASC"}),A=Object(f.a)(D,2),I=A[0],T=A[1],z=Object(c.useState)(!1),F=Object(f.a)(z,2),P=F[0],U=F[1],M=function(e){I.key===e?"ASC"!==I.direction?T({key:"",direction:"ASC"}):T({key:e,direction:"DESC"}):T({key:e,direction:"ASC"})},Y=function(e,t){return"000000".concat(e).slice(-t)},L=function(e){var t=new Date(e),n=t.getFullYear(),c=t.getMonth()+1,a=t.getDate(),r=t.getHours(),o=t.getMinutes(),i="".concat(n,"/").concat(Y(c,2),"/").concat(Y(a,2));return i+=" - ".concat(Y(r,2),":").concat(Y(o,2))};return Object(c.useEffect)((function(){var e=window.localStorage.getItem("accessToken"),t=window.localStorage.getItem("expiresDatetime");null!==e&&null!=t?(new Date).getTime()>parseInt(t,10)&&(window.location.href=l):window.location.href=l}),[]),Object(c.useEffect)((function(){var e="/jsonapi/k8s_pod/k8s_pod?page[limit]=".concat(o,"&page[offset]=").concat(d*o);""!==g&&(e+="&filter[namespace]=".concat(g)),""!==N&&(e+="&filter[cloud_context]=".concat(N)),""!==I.key&&("ASC"===I.direction?e+="&sort=".concat(I.key):e+="&sort=-".concat(I.key)),fetch(e).then((function(e){return e.json()})).then((function(e){e.links.next?U(!0):U(!1),a(e.data.map((function(e){return{drupal_internal__id:e.attributes.drupal_internal__id,cloud_context:e.attributes.cloud_context,namespace:e.attributes.namespace,name:e.attributes.name,node_name:e.attributes.node_name,status:e.attributes.status,restarts:e.attributes.restarts,cpu_usage:e.attributes.cpu_usage,memory_usage:e.attributes.memory_usage,created:L(e.attributes.created)}})))}))}),[o,d,g,N,I]),Object(c.useEffect)((function(){fetch("/jsonapi/k8s_namespace/k8s_namespace").then((function(e){return e.json()})).then((function(e){O(e.data.map((function(e){return e.attributes.name})))}))}),[]),Object(c.useEffect)((function(){fetch("/jsonapi/cloud_config/k8s").then((function(e){return e.json()})).then((function(e){v(e.data.map((function(e){return e.attributes.cloud_context})))}))}),[]),Object(c.useEffect)((function(){""!==N&&S.includes(N)||S.length>=1&&E(S[0])}),[S]),Object(b.jsx)("div",{className:"row",style:{marginTop:"2rem"},children:Object(b.jsx)("div",{className:"col",children:Object(b.jsxs)("form",{children:[Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsx)("label",{className:"control-label",children:"Cloud context"}),Object(b.jsx)("select",{className:"form-select form-control",value:N,onChange:function(e){E(e.currentTarget.value)},children:S.map((function(e){return Object(b.jsx)("option",{value:e,children:e},e)}))})]}),Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsx)("label",{className:"control-label",children:"Namespace"}),Object(b.jsxs)("select",{className:"form-select form-control",value:g,onChange:function(e){k(e.currentTarget.value)},children:[Object(b.jsx)("option",{value:"",children:"- \u3059\u3079\u3066 -"}),m.map((function(e){return Object(b.jsx)("option",{value:e,children:e},e)}))]})]}),Object(b.jsx)("div",{className:"table-responsive",children:Object(b.jsxs)("table",{className:"table table-hover table-striped sticky-enabled sticky-table",children:[Object(b.jsxs)("thead",{children:[Object(b.jsx)("th",{children:Object(b.jsx)("input",{type:"checkbox",className:"form-checkbox",title:"\u3053\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u3059\u3079\u3066\u306e\u5217\u3092\u9078\u629e\u3059\u308b"})}),Object(b.jsxs)("th",{onClick:function(){return M("namespace")},children:["Namespace","namespace"===I.key&&"ASC"===I.direction?"\u2191":"namespace"===I.key&&"DESC"===I.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return M("name")},children:["Name","name"===I.key&&"ASC"===I.direction?"\u2191":"name"===I.key&&"DESC"===I.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return M("node_name")},children:["Node","node_name"===I.key&&"ASC"===I.direction?"\u2191":"node_name"===I.key&&"DESC"===I.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return M("status")},children:["State","status"===I.key&&"ASC"===I.direction?"\u2191":"status"===I.key&&"DESC"===I.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return M("restarts")},children:["Restarts","restarts"===I.key&&"ASC"===I.direction?"\u2191":"restarts"===I.key&&"DESC"===I.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return M("cpu_usage")},children:["CPU (Usage)","cpu_usage"===I.key&&"ASC"===I.direction?"\u2191":"cpu_usage"===I.key&&"DESC"===I.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return M("memory_usage")},children:["Memory (Usage)","memory_usage"===I.key&&"ASC"===I.direction?"\u2191":"memory_usage"===I.key&&"DESC"===I.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return M("created")},children:["Created","created"===I.key&&"ASC"===I.direction?"\u2191":"created"===I.key&&"DESC"===I.direction?"\u2193":""]})]}),Object(b.jsx)("tbody",{children:n.map((function(e){return Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:Object(b.jsx)("input",{className:"form-checkbox",type:"checkbox"})}),Object(b.jsx)("td",{children:e.namespace}),Object(b.jsx)("td",{children:Object(b.jsx)("a",{href:"/clouds/k8s/".concat(e.cloud_context,"/pod/").concat(e.drupal_internal__id),target:"_blank",rel:"noopener noreferrer",children:e.name})}),Object(b.jsx)("td",{children:e.node_name}),Object(b.jsx)("td",{children:e.status}),Object(b.jsx)("td",{children:e.restarts}),Object(b.jsx)("td",{children:e.cpu_usage}),Object(b.jsx)("td",{children:e.memory_usage}),Object(b.jsx)("td",{children:e.created})]},e.drupal_internal__id)}))})]})}),Object(b.jsx)("nav",{children:Object(b.jsxs)("ul",{className:"pagination",children:[Object(b.jsx)("li",{children:Object(b.jsx)("a",{href:"#","aria-label":"\u6700\u521d\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){u(0)},children:Object(b.jsx)("span",{"aria-hidden":"true",children:"\xab"})})}),Object(b.jsx)("li",{children:Object(b.jsx)("a",{href:"#","aria-label":"\u524d\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){u(Math.max(0,d-1))},children:Object(b.jsx)("span",{"aria-hidden":"true",children:"\uff1c"})})}),Object(b.jsx)("li",{children:Object(b.jsx)("a",{href:"#",children:d+1})}),Object(b.jsx)("li",{className:P?"":"disabled",children:Object(b.jsx)("a",{href:"#","aria-label":"\u6b21\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){P&&u(d+1)},children:Object(b.jsx)("span",{"aria-hidden":"true",children:"\uff1e"})})})]})})]})})})},p=function(){return Object(b.jsx)(i.a,{basename:l,children:Object(b.jsxs)(s.c,{children:[Object(b.jsx)(s.a,{exact:!0,path:"/callback",children:Object(b.jsx)("div",{className:"container",children:Object(b.jsx)("div",{className:"row",children:Object(b.jsx)("div",{className:"col",children:Object(b.jsx)(h,{})})})})}),Object(b.jsx)(s.a,{exact:!0,path:"/main",children:Object(b.jsxs)("div",{className:"container",children:[Object(b.jsx)(O,{}),Object(b.jsx)(x,{})]})}),Object(b.jsx)(s.a,{exact:!0,path:"/",children:Object(b.jsx)("div",{className:"container",children:Object(b.jsx)("div",{className:"row",children:Object(b.jsx)("div",{className:"col",children:Object(b.jsx)(m,{})})})})})]})})},g=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,32)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),c(e),a(e),r(e),o(e)}))};o.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(p,{})}),document.getElementById("root")),g()}},[[31,1,2]]]);
//# sourceMappingURL=main.a97c22c2.chunk.js.map