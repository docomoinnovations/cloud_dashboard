(this.webpackJsonpcloud_dashboard=this.webpackJsonpcloud_dashboard||[]).push([[0],{31:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),o=n(17),r=n.n(o),i=n(18),s=n(2),l="/clouds/dashboard",d=n(9),u=n.n(d),j=n(11),b=n(0),h=function(){var e=function(){var e=Object(j.a)(u.a.mark((function e(t,n,c){var a,o,r,i,s,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("grant_type","authorization_code"),a.append("client_id",n),a.append("client_secret","cloud_dashboard"),a.append("code",t),a.append("redirect_uri",c),e.next=8,fetch("/oauth/token",{method:"POST",body:a});case 8:if((o=e.sent).ok){e.next=11;break}throw new Error("Authorization failed");case 11:return e.next=13,o.json();case 13:if(!("access_token"in(r=e.sent))){e.next=23;break}i=r.access_token,s=r.refresh_token,l=(new Date).getTime()+1e3*r.expires_in,window.localStorage.setItem("accessToken",i),window.localStorage.setItem("refreshToken",s),window.localStorage.setItem("expiresDatetime","".concat(l)),e.next=24;break;case 23:throw new Error("Authorization failed");case 24:case"end":return e.stop()}}),e)})));return function(t,n,c){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){console.group("Authorization Code Grant");var t=window.localStorage.getItem("clientId"),n=window.localStorage.getItem("redirectUri");if(null===t||null==n)return console.log("Client ID : No"),console.error("Authorization failed."),console.groupEnd(),void(window.location.href=l);console.log("Client ID : Yes");var c=new URL(window.location.href).searchParams.get("code");if(null===c)return console.log("Authorization code : No"),console.error("Authorization failed."),console.groupEnd(),void(window.location.href=l);console.log("authorization code : Yes"),e(c,t,n).then((function(){console.log("Access token : Yes"),console.groupEnd(),window.location.href=l+"/main"})).catch((function(){console.log("Access token : No"),console.error("Authorization failed."),console.groupEnd(),window.location.href=l}))}),[]),Object(b.jsx)("h2",{children:"Please waiting..."})},f=n(4),m=function(){var e=Object(c.useState)(""),t=Object(f.a)(e,2),n=t[0],a=t[1],o=Object(c.useState)(""),r=Object(f.a)(o,2),i=r[0],s=r[1],l=function(){var e=Object(j.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/jsonapi/consumer/consumer");case 2:return e.next=4,e.sent.json();case 4:t=e.sent,(n=t.data.filter((function(e){return"Cloud Dashboard"===e.attributes.label}))).length>=1&&(a(n[0].id),s(n[0].attributes.redirect));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){l()}),[]),Object(c.useEffect)((function(){window.localStorage.setItem("clientId",n)}),[n]),Object(c.useEffect)((function(){window.localStorage.setItem("redirectUri",i)}),[i]),Object(b.jsx)("form",{children:Object(b.jsx)("button",{type:"button",className:"btn btn-default",onClick:function(){var e="/oauth/authorize?response_type=code&client_id=".concat(n,"&redirect_uri=").concat(i);window.location.href=e},disabled:""===n,children:"login"})})},O=function(){Object(c.useEffect)((function(){var e=window.localStorage.getItem("accessToken"),t=window.localStorage.getItem("expiresDatetime");null!==e&&null!=t?(new Date).getTime()>parseInt(t,10)&&(window.location.href=l):window.location.href=l}),[]);return Object(b.jsx)("div",{className:"row",children:Object(b.jsx)("div",{className:"col",children:Object(b.jsx)("form",{children:Object(b.jsx)("button",{type:"button",className:"btn btn-default",onClick:function(){window.localStorage.removeItem("accessToken"),window.localStorage.removeItem("refreshToken"),window.localStorage.removeItem("expiresDatetime"),window.location.href=l},children:"logout"})})})})},x=function(){var e=Object(c.useState)([]),t=Object(f.a)(e,2),n=t[0],a=t[1],o=Object(c.useState)(30),r=Object(f.a)(o,1)[0],i=Object(c.useState)(0),s=Object(f.a)(i,2),d=s[0],u=s[1],j=Object(c.useState)(0),h=Object(f.a)(j,2),m=h[0],O=h[1],x=Object(c.useState)([]),p=Object(f.a)(x,2),g=p[0],k=p[1],w=Object(c.useState)(""),_=Object(f.a)(w,2),S=_[0],v=_[1],C=Object(c.useState)([]),y=Object(f.a)(C,2),N=y[0],E=y[1],D=Object(c.useState)(""),I=Object(f.a)(D,2),A=I[0],T=I[1],z=Object(c.useState)({key:"",direction:"ASC"}),F=Object(f.a)(z,2),M=F[0],P=F[1],U=Object(c.useState)(!1),Y=Object(f.a)(U,2),L=Y[0],B=Y[1],J=function(e){M.key===e?"ASC"!==M.direction?P({key:"",direction:"ASC"}):P({key:e,direction:"DESC"}):P({key:e,direction:"ASC"})},R=function(e,t){return"000000".concat(e).slice(-t)},G=function(e){var t=new Date(e),n=t.getFullYear(),c=t.getMonth()+1,a=t.getDate(),o=t.getHours(),r=t.getMinutes(),i="".concat(n,"/").concat(R(c,2),"/").concat(R(a,2));return i+=" - ".concat(R(o,2),":").concat(R(r,2))};return Object(c.useEffect)((function(){var e=window.localStorage.getItem("accessToken"),t=window.localStorage.getItem("expiresDatetime");null!==e&&null!=t?(new Date).getTime()>parseInt(t,10)&&(window.location.href=l):window.location.href=l}),[]),Object(c.useEffect)((function(){var e="/jsonapi/k8s_pod/k8s_pod?page[limit]=".concat(r,"&page[offset]=").concat(m*r);""!==S&&(e+="&filter[namespace]=".concat(S)),""!==A&&(e+="&filter[cloud_context]=".concat(A)),""!==M.key&&("ASC"===M.direction?e+="&sort=".concat(M.key):e+="&sort=-".concat(M.key)),fetch(e).then((function(e){return e.json()})).then((function(e){e.links.next?B(!0):B(!1),a(e.data.map((function(e){return{drupal_internal__id:e.attributes.drupal_internal__id,cloud_context:e.attributes.cloud_context,namespace:e.attributes.namespace,name:e.attributes.name,node_name:e.attributes.node_name,status:e.attributes.status,restarts:e.attributes.restarts,cpu_usage:e.attributes.cpu_usage,memory_usage:e.attributes.memory_usage,created:G(e.attributes.created)}})))}))}),[r,m,S,A,M]),Object(c.useEffect)((function(){fetch("/jsonapi/k8s_namespace/k8s_namespace").then((function(e){return e.json()})).then((function(e){k(e.data.map((function(e){return e.attributes.name})))}))}),[]),Object(c.useEffect)((function(){fetch("/jsonapi/cloud_config/k8s").then((function(e){return e.json()})).then((function(e){E(e.data.map((function(e){return e.attributes.cloud_context})))}))}),[]),Object(c.useEffect)((function(){var e="/cloud_dashboard/k8s/".concat(A,"/k8s_pod/entity/count");""!==S&&(e+="?namespace=".concat(S)),fetch(e).then((function(e){return e.json()})).then((function(e){u(e.count)}))}),[S,A]),Object(c.useEffect)((function(){""!==A&&N.includes(A)||N.length>=1&&T(N[0])}),[N]),Object(b.jsx)("div",{className:"row",style:{marginTop:"2rem"},children:Object(b.jsx)("div",{className:"col",children:Object(b.jsxs)("form",{children:[Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsx)("label",{className:"control-label",children:"Cloud context"}),Object(b.jsx)("select",{className:"form-select form-control",value:A,onChange:function(e){T(e.currentTarget.value)},children:N.map((function(e){return Object(b.jsx)("option",{value:e,children:e},e)}))})]}),Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsx)("label",{className:"control-label",children:"Namespace"}),Object(b.jsxs)("select",{className:"form-select form-control",value:S,onChange:function(e){v(e.currentTarget.value)},children:[Object(b.jsx)("option",{value:"",children:"- \u3059\u3079\u3066 -"}),g.map((function(e){return Object(b.jsx)("option",{value:e,children:e},e)}))]})]}),Object(b.jsx)("div",{className:"form-group",children:Object(b.jsxs)("label",{className:"control-label",children:["Item Count: ",d]})}),Object(b.jsx)("div",{className:"table-responsive",children:Object(b.jsxs)("table",{className:"table table-hover table-striped sticky-enabled sticky-table",children:[Object(b.jsxs)("thead",{children:[Object(b.jsx)("th",{children:Object(b.jsx)("input",{type:"checkbox",className:"form-checkbox",title:"\u3053\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u3059\u3079\u3066\u306e\u5217\u3092\u9078\u629e\u3059\u308b"})}),Object(b.jsxs)("th",{onClick:function(){return J("namespace")},children:["Namespace","namespace"===M.key&&"ASC"===M.direction?"\u2191":"namespace"===M.key&&"DESC"===M.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return J("name")},children:["Name","name"===M.key&&"ASC"===M.direction?"\u2191":"name"===M.key&&"DESC"===M.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return J("node_name")},children:["Node","node_name"===M.key&&"ASC"===M.direction?"\u2191":"node_name"===M.key&&"DESC"===M.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return J("status")},children:["State","status"===M.key&&"ASC"===M.direction?"\u2191":"status"===M.key&&"DESC"===M.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return J("restarts")},children:["Restarts","restarts"===M.key&&"ASC"===M.direction?"\u2191":"restarts"===M.key&&"DESC"===M.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return J("cpu_usage")},children:["CPU (Usage)","cpu_usage"===M.key&&"ASC"===M.direction?"\u2191":"cpu_usage"===M.key&&"DESC"===M.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return J("memory_usage")},children:["Memory (Usage)","memory_usage"===M.key&&"ASC"===M.direction?"\u2191":"memory_usage"===M.key&&"DESC"===M.direction?"\u2193":""]}),Object(b.jsxs)("th",{onClick:function(){return J("created")},children:["Created","created"===M.key&&"ASC"===M.direction?"\u2191":"created"===M.key&&"DESC"===M.direction?"\u2193":""]})]}),Object(b.jsx)("tbody",{children:n.map((function(e){return Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:Object(b.jsx)("input",{className:"form-checkbox",type:"checkbox"})}),Object(b.jsx)("td",{children:e.namespace}),Object(b.jsx)("td",{children:Object(b.jsx)("a",{href:"/clouds/k8s/".concat(e.cloud_context,"/pod/").concat(e.drupal_internal__id),target:"_blank",rel:"noopener noreferrer",children:e.name})}),Object(b.jsx)("td",{children:e.node_name}),Object(b.jsx)("td",{children:e.status}),Object(b.jsx)("td",{children:e.restarts}),Object(b.jsx)("td",{children:e.cpu_usage}),Object(b.jsx)("td",{children:e.memory_usage}),Object(b.jsx)("td",{children:e.created})]},e.drupal_internal__id)}))})]})}),Object(b.jsx)("nav",{children:Object(b.jsxs)("ul",{className:"pagination",children:[Object(b.jsx)("li",{children:Object(b.jsx)("a",{href:"#","aria-label":"\u6700\u521d\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){O(0)},children:Object(b.jsx)("span",{"aria-hidden":"true",children:"\xab"})})}),Object(b.jsx)("li",{children:Object(b.jsx)("a",{href:"#","aria-label":"\u524d\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){O(Math.max(0,m-1))},children:Object(b.jsx)("span",{"aria-hidden":"true",children:"\uff1c"})})}),Object(b.jsx)("li",{children:Object(b.jsx)("a",{href:"#",children:m+1})}),Object(b.jsx)("li",{className:L?"":"disabled",children:Object(b.jsx)("a",{href:"#","aria-label":"\u6b21\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){L&&O(m+1)},children:Object(b.jsx)("span",{"aria-hidden":"true",children:"\uff1e"})})}),Object(b.jsx)("li",{className:0!==d&&L?"":"disabled",children:Object(b.jsx)("a",{href:"#","aria-label":"\u6700\u5f8c\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){if(0!==d&&L){var e=Math.floor(1*(d+r-1)/r);O(e-1)}},children:Object(b.jsx)("span",{"aria-hidden":"true",children:"\xbb"})})})]})})]})})})},p=function(){return Object(b.jsx)(i.a,{basename:l,children:Object(b.jsxs)(s.c,{children:[Object(b.jsx)(s.a,{exact:!0,path:"/callback",children:Object(b.jsx)("div",{className:"container",children:Object(b.jsx)("div",{className:"row",children:Object(b.jsx)("div",{className:"col",children:Object(b.jsx)(h,{})})})})}),Object(b.jsx)(s.a,{exact:!0,path:"/main",children:Object(b.jsxs)("div",{className:"container",children:[Object(b.jsx)(O,{}),Object(b.jsx)(x,{})]})}),Object(b.jsx)(s.a,{exact:!0,path:"/",children:Object(b.jsx)("div",{className:"container",children:Object(b.jsx)("div",{className:"row",children:Object(b.jsx)("div",{className:"col",children:Object(b.jsx)(m,{})})})})})]})})},g=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,32)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),o(e),r(e)}))};r.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(p,{})}),document.getElementById("root")),g()}},[[31,1,2]]]);
//# sourceMappingURL=main.656aac06.chunk.js.map