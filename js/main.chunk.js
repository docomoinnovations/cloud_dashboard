(this.webpackJsonpcloud_dashboard=this.webpackJsonpcloud_dashboard||[]).push([[0],{31:function(e,t,c){"use strict";c.r(t);var n=c(1),a=c.n(n),i=c(17),r=c.n(i),o=c(18),s=c(3),l="/clouds/dashboard",d=[{name:"AWS Cloud instance",url:"/aws_cloud/instance"},{name:"K8s Pod",url:"/k8s/pod"}],u=c(9),j=c.n(u),b=c(11),h=c(0),f=function(){var e=function(){var e=Object(b.a)(j.a.mark((function e(t,c,n){var a,i,r,o,s,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("grant_type","authorization_code"),a.append("client_id",c),a.append("client_secret","cloud_dashboard"),a.append("code",t),a.append("redirect_uri",n),e.next=8,fetch("/oauth/token",{method:"POST",body:a});case 8:if((i=e.sent).ok){e.next=11;break}throw new Error("Authorization failed");case 11:return e.next=13,i.json();case 13:if(!("access_token"in(r=e.sent))){e.next=23;break}o=r.access_token,s=r.refresh_token,l=(new Date).getTime()+1e3*r.expires_in,window.localStorage.setItem("accessToken",o),window.localStorage.setItem("refreshToken",s),window.localStorage.setItem("expiresDatetime","".concat(l)),e.next=24;break;case 23:throw new Error("Authorization failed");case 24:case"end":return e.stop()}}),e)})));return function(t,c,n){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){console.group("Authorization Code Grant");var t=window.localStorage.getItem("clientId"),c=window.localStorage.getItem("redirectUri");if(null===t||null==c)return console.log("Client ID : No"),console.error("Authorization failed."),console.groupEnd(),void(window.location.href=l);console.log("Client ID : Yes");var n=new URL(window.location.href).searchParams.get("code");if(null===n)return console.log("Authorization code : No"),console.error("Authorization failed."),console.groupEnd(),void(window.location.href=l);console.log("authorization code : Yes"),e(n,t,c).then((function(){console.log("Access token : Yes"),console.groupEnd(),window.location.href=l+"/aws_cloud/instance"})).catch((function(){console.log("Access token : No"),console.error("Authorization failed."),console.groupEnd(),window.location.href=l}))}),[]),Object(h.jsx)("div",{className:"row",children:Object(h.jsx)("div",{className:"col",children:Object(h.jsx)("h2",{children:"Please waiting..."})})})},O=c(2),x=function(){var e=Object(n.useState)(""),t=Object(O.a)(e,2),c=t[0],a=t[1],i=Object(n.useState)(""),r=Object(O.a)(i,2),o=r[0],s=r[1],l=function(){var e=Object(b.a)(j.a.mark((function e(){var t,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/jsonapi/consumer/consumer");case 2:return e.next=4,e.sent.json();case 4:t=e.sent,(c=t.data.filter((function(e){return"Cloud Dashboard"===e.attributes.label}))).length>=1&&(a(c[0].id),s(c[0].attributes.redirect));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){l()}),[]),Object(n.useEffect)((function(){window.localStorage.setItem("clientId",c)}),[c]),Object(n.useEffect)((function(){window.localStorage.setItem("redirectUri",o)}),[o]),Object(h.jsx)("div",{className:"row",children:Object(h.jsx)("div",{className:"col",children:Object(h.jsx)("form",{children:Object(h.jsx)("button",{type:"button",className:"btn btn-default",onClick:function(){var e="/oauth/authorize?response_type=code&client_id=".concat(c,"&redirect_uri=").concat(o);window.location.href=e},disabled:""===c,children:"login"})})})})},m=function(e){var t=e.selectedMenuName;Object(n.useEffect)((function(){var e=window.localStorage.getItem("accessToken"),t=window.localStorage.getItem("expiresDatetime");null!==e&&null!=t?(new Date).getTime()>parseInt(t,10)&&(window.location.href=l):window.location.href=l}),[]);return Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)("ul",{className:"nav nav-tabs",children:[d.map((function(e){return Object(h.jsx)("li",{role:"presentation",className:e.name===t?"active":"",children:Object(h.jsx)("a",{href:"".concat(l).concat(e.url),children:e.name})},e.name)})),Object(h.jsx)("li",{role:"presentation",children:Object(h.jsx)("a",{href:"#",onClick:function(){window.localStorage.removeItem("accessToken"),window.localStorage.removeItem("refreshToken"),window.localStorage.removeItem("expiresDatetime"),window.location.href=l},children:"logout"})})]})})},p=function(){var e=Object(n.useState)([]),t=Object(O.a)(e,2),c=t[0],a=t[1],i=Object(n.useState)(30),r=Object(O.a)(i,1)[0],o=Object(n.useState)(0),s=Object(O.a)(o,2),d=s[0],u=s[1],j=Object(n.useState)(0),b=Object(O.a)(j,2),f=b[0],x=b[1],m=Object(n.useState)([]),p=Object(O.a)(m,2),k=p[0],_=p[1],g=Object(n.useState)(""),w=Object(O.a)(g,2),y=w[0],C=w[1],S=Object(n.useState)([]),v=Object(O.a)(S,2),N=v[0],E=v[1],A=Object(n.useState)(""),D=Object(O.a)(A,2),I=D[0],T=D[1],z=Object(n.useState)({key:"",direction:"ASC"}),M=Object(O.a)(z,2),P=M[0],F=M[1],U=Object(n.useState)(!1),Y=Object(O.a)(U,2),L=Y[0],B=Y[1],H=function(e){P.key===e?"ASC"!==P.direction?F({key:"",direction:"ASC"}):F({key:e,direction:"DESC"}):F({key:e,direction:"ASC"})},J=function(e,t){return"000000".concat(e).slice(-t)},K=function(e){var t=new Date(e),c=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),i=t.getHours(),r=t.getMinutes(),o="".concat(c,"/").concat(J(n,2),"/").concat(J(a,2));return o+=" - ".concat(J(i,2),":").concat(J(r,2))};return Object(n.useEffect)((function(){var e=window.localStorage.getItem("accessToken"),t=window.localStorage.getItem("expiresDatetime");null!==e&&null!=t?(new Date).getTime()>parseInt(t,10)&&(window.location.href=l):window.location.href=l}),[]),Object(n.useEffect)((function(){var e="/jsonapi/k8s_pod/k8s_pod?page[limit]=".concat(r,"&page[offset]=").concat(f*r);""!==y&&(e+="&filter[namespace]=".concat(y)),""!==I&&(e+="&filter[cloud_context]=".concat(I)),""!==P.key&&("ASC"===P.direction?e+="&sort=".concat(P.key):e+="&sort=-".concat(P.key)),fetch(e).then((function(e){return e.json()})).then((function(e){e.links.next?B(!0):B(!1),a(e.data.map((function(e){return{drupal_internal__id:e.attributes.drupal_internal__id,cloud_context:e.attributes.cloud_context,namespace:e.attributes.namespace,name:e.attributes.name,node_name:e.attributes.node_name,status:e.attributes.status,restarts:e.attributes.restarts,cpu_usage:e.attributes.cpu_usage,memory_usage:e.attributes.memory_usage,created:K(e.attributes.created)}})))}))}),[r,f,y,I,P]),Object(n.useEffect)((function(){fetch("/jsonapi/k8s_namespace/k8s_namespace").then((function(e){return e.json()})).then((function(e){_(e.data.map((function(e){return e.attributes.name})))}))}),[]),Object(n.useEffect)((function(){fetch("/jsonapi/cloud_config/k8s").then((function(e){return e.json()})).then((function(e){E(e.data.map((function(e){return e.attributes.cloud_context})))}))}),[]),Object(n.useEffect)((function(){var e="/cloud_dashboard/k8s/".concat(I,"/k8s_pod/entity/count");""!==y&&(e+="?namespace=".concat(y)),fetch(e).then((function(e){return e.json()})).then((function(e){u(e.count)}))}),[y,I]),Object(n.useEffect)((function(){""!==I&&N.includes(I)||N.length>=1&&T(N[0])}),[N]),Object(h.jsx)("div",{className:"row",style:{marginTop:"2rem"},children:Object(h.jsx)("div",{className:"col",children:Object(h.jsxs)("form",{children:[Object(h.jsxs)("div",{className:"form-group",children:[Object(h.jsx)("label",{className:"control-label",children:"Cloud context"}),Object(h.jsx)("select",{className:"form-select form-control",value:I,onChange:function(e){T(e.currentTarget.value)},children:N.map((function(e){return Object(h.jsx)("option",{value:e,children:e},e)}))})]}),Object(h.jsxs)("div",{className:"form-group",children:[Object(h.jsx)("label",{className:"control-label",children:"Namespace"}),Object(h.jsxs)("select",{className:"form-select form-control",value:y,onChange:function(e){C(e.currentTarget.value)},children:[Object(h.jsx)("option",{value:"",children:"- \u3059\u3079\u3066 -"}),k.map((function(e){return Object(h.jsx)("option",{value:e,children:e},e)}))]})]}),Object(h.jsx)("div",{className:"form-group",children:Object(h.jsxs)("label",{className:"control-label",children:["Item Count: ",d]})}),Object(h.jsx)("div",{className:"table-responsive",children:Object(h.jsxs)("table",{className:"table table-hover table-striped sticky-enabled sticky-table",children:[Object(h.jsxs)("thead",{children:[Object(h.jsx)("th",{children:Object(h.jsx)("input",{type:"checkbox",className:"form-checkbox",title:"\u3053\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u3059\u3079\u3066\u306e\u5217\u3092\u9078\u629e\u3059\u308b"})}),Object(h.jsxs)("th",{onClick:function(){return H("namespace")},children:["Namespace","namespace"===P.key&&"ASC"===P.direction?"\u2191":"namespace"===P.key&&"DESC"===P.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return H("name")},children:["Name","name"===P.key&&"ASC"===P.direction?"\u2191":"name"===P.key&&"DESC"===P.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return H("node_name")},children:["Node","node_name"===P.key&&"ASC"===P.direction?"\u2191":"node_name"===P.key&&"DESC"===P.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return H("status")},children:["State","status"===P.key&&"ASC"===P.direction?"\u2191":"status"===P.key&&"DESC"===P.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return H("restarts")},children:["Restarts","restarts"===P.key&&"ASC"===P.direction?"\u2191":"restarts"===P.key&&"DESC"===P.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return H("cpu_usage")},children:["CPU (Usage)","cpu_usage"===P.key&&"ASC"===P.direction?"\u2191":"cpu_usage"===P.key&&"DESC"===P.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return H("memory_usage")},children:["Memory (Usage)","memory_usage"===P.key&&"ASC"===P.direction?"\u2191":"memory_usage"===P.key&&"DESC"===P.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return H("created")},children:["Created","created"===P.key&&"ASC"===P.direction?"\u2191":"created"===P.key&&"DESC"===P.direction?"\u2193":""]})]}),Object(h.jsx)("tbody",{children:c.map((function(e){return Object(h.jsxs)("tr",{children:[Object(h.jsx)("td",{children:Object(h.jsx)("input",{className:"form-checkbox",type:"checkbox"})}),Object(h.jsx)("td",{children:e.namespace}),Object(h.jsx)("td",{children:Object(h.jsx)("a",{href:"/clouds/k8s/".concat(e.cloud_context,"/pod/").concat(e.drupal_internal__id),target:"_blank",rel:"noopener noreferrer",children:e.name})}),Object(h.jsx)("td",{children:e.node_name}),Object(h.jsx)("td",{children:e.status}),Object(h.jsx)("td",{children:e.restarts}),Object(h.jsx)("td",{children:e.cpu_usage}),Object(h.jsx)("td",{children:e.memory_usage}),Object(h.jsx)("td",{children:e.created})]},e.drupal_internal__id)}))})]})}),Object(h.jsx)("nav",{children:Object(h.jsxs)("ul",{className:"pagination",children:[Object(h.jsx)("li",{children:Object(h.jsx)("a",{href:"#","aria-label":"\u6700\u521d\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){x(0)},children:Object(h.jsx)("span",{"aria-hidden":"true",children:"\xab"})})}),Object(h.jsx)("li",{children:Object(h.jsx)("a",{href:"#","aria-label":"\u524d\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){x(Math.max(0,f-1))},children:Object(h.jsx)("span",{"aria-hidden":"true",children:"\uff1c"})})}),Object(h.jsx)("li",{children:Object(h.jsx)("a",{href:"#",children:f+1})}),Object(h.jsx)("li",{className:L?"":"disabled",children:Object(h.jsx)("a",{href:"#","aria-label":"\u6b21\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){L&&x(f+1)},children:Object(h.jsx)("span",{"aria-hidden":"true",children:"\uff1e"})})}),Object(h.jsx)("li",{className:0!==d&&L?"":"disabled",children:Object(h.jsx)("a",{href:"#","aria-label":"\u6700\u5f8c\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){if(0!==d&&L){var e=Math.floor(1*(d+r-1)/r);x(e-1)}},children:Object(h.jsx)("span",{"aria-hidden":"true",children:"\xbb"})})})]})})]})})})},k=function(){var e=Object(n.useState)([]),t=Object(O.a)(e,2),c=t[0],a=t[1],i=Object(n.useState)(30),r=Object(O.a)(i,1)[0],o=Object(n.useState)(0),s=Object(O.a)(o,2),d=s[0],u=s[1],j=Object(n.useState)(0),b=Object(O.a)(j,2),f=b[0],x=b[1],m=Object(n.useState)([]),p=Object(O.a)(m,2),k=p[0],_=p[1],g=Object(n.useState)(""),w=Object(O.a)(g,2),y=w[0],C=w[1],S=Object(n.useState)({key:"",direction:"ASC"}),v=Object(O.a)(S,2),N=v[0],E=v[1],A=Object(n.useState)(!1),D=Object(O.a)(A,2),I=D[0],T=D[1],z=function(e){N.key===e?"ASC"!==N.direction?E({key:"",direction:"ASC"}):E({key:e,direction:"DESC"}):E({key:e,direction:"ASC"})},M=function(e,t){return"000000".concat(e).slice(-t)},P=function(e){var t=new Date(e),c=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),i=t.getHours(),r=t.getMinutes(),o="".concat(c,"/").concat(M(n,2),"/").concat(M(a,2));return o+=" - ".concat(M(i,2),":").concat(M(r,2))};return Object(n.useEffect)((function(){var e=window.localStorage.getItem("accessToken"),t=window.localStorage.getItem("expiresDatetime");null!==e&&null!=t?(new Date).getTime()>parseInt(t,10)&&(window.location.href=l):window.location.href=l}),[]),Object(n.useEffect)((function(){var e="/jsonapi/aws_cloud_instance/aws_cloud_instance?page[limit]=".concat(r,"&page[offset]=").concat(f*r);""!==y&&(e+="&filter[cloud_context]=".concat(y)),""!==N.key&&("ASC"===N.direction?e+="&sort=".concat(N.key):e+="&sort=-".concat(N.key)),fetch(e).then((function(e){return e.json()})).then((function(e){e.links.next?T(!0):T(!1),a(e.data.map((function(e){return{drupal_internal__id:e.attributes.drupal_internal__id,cloud_context:e.attributes.cloud_context,name:e.attributes.name,public_ip:e.attributes.public_ip,instance_state:e.attributes.instance_state,instance_type:e.attributes.instance_type,availability_zone:e.attributes.availability_zone,cost:e.attributes.cost,created:P(e.attributes.created)}})))}))}),[r,f,y,N]),Object(n.useEffect)((function(){fetch("/jsonapi/cloud_config/aws_cloud").then((function(e){return e.json()})).then((function(e){_(e.data.map((function(e){return e.attributes.cloud_context})))}))}),[]),Object(n.useEffect)((function(){var e="/cloud_dashboard/aws_cloud/".concat(y,"/aws_cloud_instance/entity/count");fetch(e).then((function(e){return e.json()})).then((function(e){u(e.count)}))}),[y]),Object(n.useEffect)((function(){""!==y&&k.includes(y)||k.length>=1&&C(k[0])}),[k]),Object(h.jsx)("div",{className:"row",style:{marginTop:"2rem"},children:Object(h.jsx)("div",{className:"col",children:Object(h.jsxs)("form",{children:[Object(h.jsxs)("div",{className:"form-group",children:[Object(h.jsx)("label",{className:"control-label",children:"Cloud context"}),Object(h.jsx)("select",{className:"form-select form-control",value:y,onChange:function(e){C(e.currentTarget.value)},children:k.map((function(e){return Object(h.jsx)("option",{value:e,children:e},e)}))})]}),Object(h.jsx)("div",{className:"form-group",children:Object(h.jsxs)("label",{className:"control-label",children:["Item Count: ",d]})}),Object(h.jsx)("div",{className:"table-responsive",children:Object(h.jsxs)("table",{className:"table table-hover table-striped sticky-enabled sticky-table",children:[Object(h.jsxs)("thead",{children:[Object(h.jsx)("th",{children:Object(h.jsx)("input",{type:"checkbox",className:"form-checkbox",title:"\u3053\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u3059\u3079\u3066\u306e\u5217\u3092\u9078\u629e\u3059\u308b"})}),Object(h.jsxs)("th",{onClick:function(){return z("name")},children:["Name","name"===N.key&&"ASC"===N.direction?"\u2191":"name"===N.key&&"DESC"===N.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return z("public_ip")},children:["Public IP","public_ip"===N.key&&"ASC"===N.direction?"\u2191":"public_ip"===N.key&&"DESC"===N.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return z("instance_state")},children:["Instance State","instance_state"===N.key&&"ASC"===N.direction?"\u2191":"instance_state"===N.key&&"DESC"===N.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return z("instance_type")},children:["Instance Type","instance_type"===N.key&&"ASC"===N.direction?"\u2191":"instance_type"===N.key&&"DESC"===N.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return z("availability_zone")},children:["Availability Zone","availability_zone"===N.key&&"ASC"===N.direction?"\u2191":"availability_zone"===N.key&&"DESC"===N.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return z("cost")},children:["Cost","cost"===N.key&&"ASC"===N.direction?"\u2191":"cost"===N.key&&"DESC"===N.direction?"\u2193":""]}),Object(h.jsxs)("th",{onClick:function(){return z("created")},children:["Created","created"===N.key&&"ASC"===N.direction?"\u2191":"created"===N.key&&"DESC"===N.direction?"\u2193":""]})]}),Object(h.jsx)("tbody",{children:c.map((function(e){return Object(h.jsxs)("tr",{children:[Object(h.jsx)("td",{children:Object(h.jsx)("input",{className:"form-checkbox",type:"checkbox"})}),Object(h.jsx)("td",{children:Object(h.jsx)("a",{href:"/clouds/aws_cloud/".concat(e.cloud_context,"/instance/").concat(e.drupal_internal__id),target:"_blank",rel:"noopener noreferrer",children:e.name})}),Object(h.jsx)("td",{children:e.public_ip}),Object(h.jsx)("td",{children:e.instance_state}),Object(h.jsx)("td",{children:e.instance_type}),Object(h.jsx)("td",{children:e.availability_zone}),Object(h.jsx)("td",{children:null!==e.cost?"$".concat(e.cost):""}),Object(h.jsx)("td",{children:e.created})]},e.drupal_internal__id)}))})]})}),Object(h.jsx)("nav",{children:Object(h.jsxs)("ul",{className:"pagination",children:[Object(h.jsx)("li",{children:Object(h.jsx)("a",{href:"#","aria-label":"\u6700\u521d\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){x(0)},children:Object(h.jsx)("span",{"aria-hidden":"true",children:"\xab"})})}),Object(h.jsx)("li",{children:Object(h.jsx)("a",{href:"#","aria-label":"\u524d\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){x(Math.max(0,f-1))},children:Object(h.jsx)("span",{"aria-hidden":"true",children:"\uff1c"})})}),Object(h.jsx)("li",{children:Object(h.jsx)("a",{href:"#",children:f+1})}),Object(h.jsx)("li",{className:I?"":"disabled",children:Object(h.jsx)("a",{href:"#","aria-label":"\u6b21\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){I&&x(f+1)},children:Object(h.jsx)("span",{"aria-hidden":"true",children:"\uff1e"})})}),Object(h.jsx)("li",{className:0!==d&&I?"":"disabled",children:Object(h.jsx)("a",{href:"#","aria-label":"\u6700\u5f8c\u306e\u30da\u30fc\u30b8\u3078",onClick:function(){if(0!==d&&I){var e=Math.floor(1*(d+r-1)/r);x(e-1)}},children:Object(h.jsx)("span",{"aria-hidden":"true",children:"\xbb"})})})]})})]})})})},_=function(){return Object(h.jsx)(o.a,{basename:l,children:Object(h.jsxs)(s.c,{children:[Object(h.jsx)(s.a,{exact:!0,path:"/aws_cloud/instance",children:Object(h.jsxs)("div",{className:"container",children:[Object(h.jsx)(m,{selectedMenuName:"AWS Cloud instance"}),Object(h.jsx)(k,{})]})}),Object(h.jsx)(s.a,{exact:!0,path:"/callback",children:Object(h.jsx)("div",{className:"container",children:Object(h.jsx)(f,{})})}),Object(h.jsx)(s.a,{exact:!0,path:"/k8s/pod",children:Object(h.jsxs)("div",{className:"container",children:[Object(h.jsx)(m,{selectedMenuName:"K8s Pod"}),Object(h.jsx)(p,{})]})}),Object(h.jsx)(s.a,{exact:!0,path:"/",children:Object(h.jsx)("div",{className:"container",children:Object(h.jsx)(x,{})})})]})})},g=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,32)).then((function(t){var c=t.getCLS,n=t.getFID,a=t.getFCP,i=t.getLCP,r=t.getTTFB;c(e),n(e),a(e),i(e),r(e)}))};r.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(_,{})}),document.getElementById("root")),g()}},[[31,1,2]]]);
//# sourceMappingURL=main.20de9f8d.chunk.js.map